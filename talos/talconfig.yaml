clusterName: homeprod
talosVersion: v1.3.6
kubernetesVersion: 1.26.2
endpoint: https://192.168.29.168:6443  # TODO
cniConfig:
  name: none
#  urls: 
#    - http://192.168.3.103:8071/install.yaml
nodes:
  - hostname: homeprod-cw01
    controlPlane: true
    installDiskSelector:
      size: '<= 20GB'
    ipAddress: 192.168.29.168 # A6:4E:F3:1E:9E:4F
    networkInterfaces:
      - interface: ens18
        dhcp: true
        vip:
          ip: 192.168.29.10
  - hostname: homeprod-cw02
    controlPlane: true
    installDiskSelector:
      size: '<= 36GB'
    ipAddress: 192.168.29.169
    networkInterfaces:
      - interface: ens18
        dhcp: true
        vip:
          ip: 192.168.29.10
  - hostname: homeprod-cw03
    controlPlane: true
    installDiskSelector:
      size: '<= 36GB'
    ipAddress: 192.168.29.170
    networkInterfaces:
      - interface: ens18
        dhcp: true
        vip:
          ip: 192.168.29.10
controlPlane:
  inlinePatch:
    cluster:
      allowSchedulingOnMasters: true
      aescbcEncryptionSecret: ${aescbcEncryptionKey}
      aggregatorCA:
        crt: ${k8sAggregatorCert}
        key: ${k8sAggregatorCertKey}
      ca:
        crt: ${clusterCert}
        key: ${clusterCertKey}
      etcd:
        ca:
          crt: ${etcdCert}
          key: ${etcdCertKey}
      proxy:
        disabled: true
      secret: ${clusterSecret}
      serviceAccount:
        key: ${k8sServiceAccountKey}
      token: ${clusterToken}
      apiServer:
        auditPolicy:
          apiVersion: audit.k8s.io/v1
          kind: Policy
          rules:
            # Log the request body of configmap changes in kube-system.
            - level: Request
              resources:
              - group: "" # core API group
                resources: ["configmaps"]
              namespaces: ["kube-system"]
            # Log the request body of secret changes in flux-system.
            - level: Request
              resources:
              - group: "" # core API group
                resources: ["secrets"]
              namespaces: ["flux-system"]
            # A catch-all rule to log all other requests at the Metadata level.
            - level: Metadata
    machine:
      ca:
        crt: ${machineCert}
        key: ${machineCertKey}
      token: ${machineToken}
#worker:
# inlinePatch:
#   cluster:
#     aescbcEncryptionSecret: ${aescbcEncryptionKey}
#     ca:
#       crt: ${clusterCert}
#       key: ${clusterCertKey}
#     secret: ${clusterSecret}
#     token: ${clusterToken}
#   machine:
#     ca:
#       crt: ${machineCert}
#       key: ${machineCertKey}
#     token: ${machineToken}
